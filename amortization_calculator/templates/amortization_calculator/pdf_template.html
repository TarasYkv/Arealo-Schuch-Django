<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }}</title>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <div class="logo-section">
            <h1 style="color: #0075BE; font-size: 24pt; margin: 0;">
                <strong>Wirtschaftlichkeitsrechner</strong>
            </h1>
            <p style="color: #666; font-size: 12pt; margin: 5px 0 0 0;">
                LED-Beleuchtungsanalyse mit LMS Lichtmanagementsystem
            </p>
        </div>

        <div style="text-align: right; margin-top: 20px;">
            <p style="margin: 0; color: #666;">{{ generated_date|date:"d.m.Y" }}</p>
        </div>
    </div>

    <!-- Company Information -->
    <div class="company-info">
        <table style="width: 100%; border: none;">
            <tr>
                <td style="border: none; width: 50%; vertical-align: top;">
                    <h3 style="color: #0075BE; margin-bottom: 10px;">Projektdaten</h3>
                    <p><strong>Firma:</strong> {{ calculation.firmenname|default:"Nicht angegeben" }}</p>
                    <p><strong>Projekt:</strong> {{ calculation.projektname|default:"Nicht angegeben" }}</p>
                    <p><strong>Strompreis:</strong> {{ calculation.strompreis }} €/kWh</p>
                    <p><strong>Anlagentyp:</strong> {{ calculation.get_anlagen_typ_display }}</p>
                </td>
                <td style="border: none; width: 50%; vertical-align: top;">
                    <h3 style="color: #0075BE; margin-bottom: 10px;">Kontaktdaten</h3>
                    <p><strong>Name:</strong> {{ calculation.kontakt_name|default:"Nicht angegeben" }}</p>
                    <p><strong>E-Mail:</strong> {{ calculation.kontakt_email|default:"Nicht angegeben" }}</p>
                    <p><strong>Telefon:</strong> {{ calculation.kontakt_telefon|default:"Nicht angegeben" }}</p>
                </td>
            </tr>
        </table>
    </div>

    <!-- Executive Summary -->
    <div class="section">
        <div class="section-title">Zusammenfassung</div>

        <div class="highlight-box">
            <h3 style="color: #0075BE; margin-top: 0;">Wirtschaftliche Vorteile der LED-Modernisierung</h3>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">{{ savings_data.cost_savings_percent_lms|floatformat:1 }}%</div>
                    <div class="metric-label">Kosteneinsparung pro Jahr</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ calculation.amortisation_gesamt_jahre|floatformat:1 }}</div>
                    <div class="metric-label">Jahre bis zur Amortisation</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ savings_data.energy_savings_percent_lms|floatformat:0 }}%</div>
                    <div class="metric-label">Energieeinsparung</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ savings_data.co2_savings_lms|floatformat:0 }}</div>
                    <div class="metric-label">kg CO₂-Einsparung/Jahr</div>
                </div>
            </div>

            <p style="margin-top: 20px; font-size: 12pt;">
                Die Modernisierung der Beleuchtungsanlage mit LED-Technologie und LMS
                Lichtmanagementsystem führt zu erheblichen Einsparungen bei Energie- und Betriebskosten
                sowie zu einer deutlichen Reduktion der CO₂-Emissionen.
            </p>
        </div>
    </div>

    <!-- Cost Analysis Section -->
    <div class="section">
        <div class="section-title">Kostenanalyse</div>

        {% if matplotlib_available and charts.cost_chart %}
        <div class="chart-container">
            <img src="{{ charts.cost_chart }}" alt="Kostenvergleich">
            <div class="chart-caption">Abbildung 1: Jährliche Betriebskosten im Vergleich</div>
        </div>
        {% else %}
        <div class="highlight-box">
            <strong>Diagramm nicht verfügbar</strong><br>
            Die grafische Darstellung des Kostenvergleichs ist aufgrund fehlender Systemkomponenten nicht verfügbar. Die Werte finden Sie in der nachfolgenden Tabelle.
        </div>
        {% endif %}

        <table>
            <thead>
                <tr>
                    <th>System</th>
                    <th>Jährliche Kosten</th>
                    <th>Einsparung</th>
                    <th>Einsparung (%)</th>
                </tr>
            </thead>
            <tbody>
                {% if calculation.neue_anlage_vorhanden %}
                <tr>
                    <td>Bestandsanlage</td>
                    <td>{{ calculation.kosten_alt_jahr|floatformat:0 }} €</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                {% endif %}
                <tr>
                    <td>LED-Leuchten</td>
                    <td>{{ calculation.kosten_neu_ohne_lms_jahr|floatformat:0 }} €</td>
                    <td>{{ savings_data.cost_savings_led|floatformat:0 }} €</td>
                    <td class="text-success">{{ savings_data.cost_savings_percent_led|floatformat:1 }}%</td>
                </tr>
                <tr style="background: #e8f5e8;">
                    <td><strong>LED + LMS</strong></td>
                    <td><strong>{{ calculation.kosten_neu_mit_lms_jahr|floatformat:0 }} €</strong></td>
                    <td class="text-success"><strong>{{ savings_data.cost_savings_lms|floatformat:0 }} €</strong></td>
                    <td class="text-success"><strong>{{ savings_data.cost_savings_percent_lms|floatformat:1 }}%</strong></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Amortization Analysis -->
    <div class="section">
        <div class="section-title">Amortisationsanalyse</div>

        {% if matplotlib_available and charts.amortization_chart %}
        <div class="chart-container">
            <img src="{{ charts.amortization_chart }}" alt="Amortisationszeiten">
            <div class="chart-caption">Abbildung 2: Amortisationszeiten der verschiedenen Systeme</div>
        </div>
        {% else %}
        <div class="highlight-box">
            <strong>Diagramm nicht verfügbar</strong><br>
            Die grafische Darstellung der Amortisationszeiten ist aufgrund fehlender Systemkomponenten nicht verfügbar. Die Werte finden Sie in den nachfolgenden Boxen.
        </div>
        {% endif %}

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 30px 0;">
            <div class="metric-card text-center">
                <div style="font-size: 16pt; font-weight: bold; color: #0075BE;">
                    {{ calculation.amortisation_neu_jahre|floatformat:1 }}
                </div>
                <div style="font-size: 11pt; color: #666; margin-top: 5px;">Jahre</div>
                <div style="font-size: 10pt; color: #333; margin-top: 5px;">LED-Leuchten</div>
            </div>
            <div class="metric-card text-center">
                <div style="font-size: 16pt; font-weight: bold; color: #ffc107;">
                    {{ calculation.amortisation_lms_jahre|floatformat:1 }}
                </div>
                <div style="font-size: 11pt; color: #666; margin-top: 5px;">Jahre</div>
                <div style="font-size: 10pt; color: #333; margin-top: 5px;">Nur LMS</div>
            </div>
            <div class="metric-card text-center" style="background: #e8f5e8; border-color: #28a745;">
                <div style="font-size: 16pt; font-weight: bold; color: #28a745;">
                    {{ calculation.amortisation_gesamt_jahre|floatformat:1 }}
                </div>
                <div style="font-size: 11pt; color: #666; margin-top: 5px;">Jahre</div>
                <div style="font-size: 10pt; color: #333; margin-top: 5px;"><strong>LED + LMS</strong></div>
            </div>
        </div>

        <div class="highlight-box">
            <p style="margin: 0; font-size: 12pt;">
                <strong>Investition:</strong> Die Gesamtinvestition für LED-Beleuchtung und LMS-System beträgt
                {{ savings_data.investment_total|floatformat:0 }} € und amortisiert sich innerhalb von
                <strong>{{ calculation.amortisation_gesamt_jahre|floatformat:1 }} Jahren</strong>
                durch die Energieeinsparungen.
            </p>
        </div>
    </div>

    <div class="page-break"></div>

    <!-- Energy Consumption Analysis -->
    <div class="section">
        <div class="section-title">Energieverbrauchsanalyse</div>

        <div class="chart-container">
            {% if matplotlib_available and charts.energy_chart %}
            <img src="{{ charts.energy_chart }}" alt="Energieverbrauch">
            {% else %}
            <div class="highlight-box" style="text-align: center; padding: 40px;">
                <strong>Energieverbrauchsdiagramm nicht verfügbar</strong><br>
                <em>Grafische Darstellung aufgrund fehlender Systemkomponenten nicht möglich.</em>
            </div>
            {% endif %}
            <div class="chart-caption">Abbildung 3: Jährlicher Energieverbrauch im Vergleich</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>System</th>
                    <th>Verbrauch (kWh/Jahr)</th>
                    <th>Einsparung (kWh)</th>
                    <th>Einsparung (%)</th>
                </tr>
            </thead>
            <tbody>
                {% if calculation.neue_anlage_vorhanden %}
                <tr>
                    <td>Bestandsanlage</td>
                    <td>{{ savings_data.alt_verbrauch|floatformat:0 }}</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                {% endif %}
                <tr>
                    <td>LED-Leuchten</td>
                    <td>{{ savings_data.neu_verbrauch|floatformat:0 }}</td>
                    <td>{{ savings_data.energy_savings_led|floatformat:0 }}</td>
                    <td class="text-success">{{ savings_data.energy_savings_percent_led|floatformat:1 }}%</td>
                </tr>
                <tr style="background: #e8f5e8;">
                    <td><strong>LED + LMS</strong></td>
                    <td><strong>{{ savings_data.neu_verbrauch_lms|floatformat:0 }}</strong></td>
                    <td class="text-success"><strong>{{ savings_data.energy_savings_lms|floatformat:0 }}</strong></td>
                    <td class="text-success"><strong>{{ savings_data.energy_savings_percent_lms|floatformat:1 }}%</strong></td>
                </tr>
            </tbody>
        </table>

        <div class="highlight-box">
            <h4 style="color: #28a745; margin-top: 0;">LMS Lichtmanagementsystem Funktionen</h4>
            <ul style="margin-bottom: 0;">
                <li><strong>Bewegungssensor:</strong> Automatische Helligkeitsregelung bei An-/Abwesenheit</li>
                <li><strong>Tageslichtsensor:</strong> Anpassung an natürliches Licht</li>
                <li><strong>Kalenderfunktion:</strong> Zeitgesteuerte Beleuchtung</li>
                <li><strong>Szenen-Management:</strong> Verschiedene Beleuchtungsszenarien</li>
                <li><strong>Energiemonitoring:</strong> Kontinuierliche Verbrauchsüberwachung</li>
            </ul>
        </div>
    </div>

    <!-- Environmental Impact -->
    <div class="section">
        <div class="section-title">Umweltauswirkungen</div>

        <div class="chart-container">
            {% if matplotlib_available and charts.co2_chart %}
            <img src="{{ charts.co2_chart }}" alt="CO2-Emissionen">
            {% else %}
            <div class="highlight-box" style="text-align: center; padding: 40px;">
                <strong>CO₂-Emissionsdiagramm nicht verfügbar</strong><br>
                <em>Grafische Darstellung aufgrund fehlender Systemkomponenten nicht möglich.</em>
            </div>
            {% endif %}
            <div class="chart-caption">Abbildung 4: CO₂-Emissionen pro Jahr im Vergleich</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>System</th>
                    <th>CO₂-Emissionen (kg/Jahr)</th>
                    <th>Reduktion (kg)</th>
                    <th>Reduktion (%)</th>
                </tr>
            </thead>
            <tbody>
                {% if calculation.neue_anlage_vorhanden %}
                <tr>
                    <td>Bestandsanlage</td>
                    <td>{{ calculation.co2_emission_alt_kg_jahr|floatformat:0 }}</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                {% endif %}
                <tr>
                    <td>LED-Leuchten</td>
                    <td>{{ calculation.co2_emission_neu_ohne_lms_kg_jahr|floatformat:0 }}</td>
                    <td class="text-success">{{ savings_data.co2_savings_led|floatformat:0 }}</td>
                    <td class="text-success">{{ savings_data.co2_savings_percent_led|floatformat:1 }}%</td>
                </tr>
                <tr style="background: #e8f5e8;">
                    <td><strong>LED + LMS</strong></td>
                    <td><strong>{{ calculation.co2_emission_neu_mit_lms_kg_jahr|floatformat:0 }}</strong></td>
                    <td class="text-success"><strong>{{ savings_data.co2_savings_lms|floatformat:0 }}</strong></td>
                    <td class="text-success"><strong>{{ savings_data.co2_savings_percent_lms|floatformat:1 }}%</strong></td>
                </tr>
            </tbody>
        </table>

        <div class="highlight-box">
            <p style="margin: 0; font-size: 12pt;">
                <strong>Umweltbeitrag:</strong> Durch die Modernisierung werden jährlich
                <strong>{{ savings_data.co2_savings_lms|floatformat:0 }} kg CO₂</strong> eingespart.
                Dies entspricht der CO₂-Bindung von etwa
                <strong>{{ savings_data.trees_equivalent|floatformat:0 }} Bäumen</strong> pro Jahr.
            </p>
        </div>
    </div>

    <!-- Technical Specifications -->
    <div class="section">
        <div class="section-title">Technische Spezifikationen</div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            {% if calculation.neue_anlage_vorhanden %}
            <div>
                <h4 style="color: #0075BE; margin-bottom: 15px;">Bestandsanlage</h4>
                <table style="font-size: 10pt;">
                    <tr><td><strong>Hersteller:</strong></td><td>{{ calculation.alt_hersteller|default:"-" }}</td></tr>
                    <tr><td><strong>Modell:</strong></td><td>{{ calculation.alt_modell|default:"-" }}</td></tr>
                    <tr><td><strong>Leistung:</strong></td><td>{{ calculation.alt_leistung }} W</td></tr>
                    <tr><td><strong>Anzahl:</strong></td><td>{{ calculation.alt_anzahl }} Stück</td></tr>
                    <tr><td><strong>Betrieb:</strong></td><td>{{ calculation.alt_stunden_pro_tag }}h/Tag, {{ calculation.alt_tage_pro_jahr }} Tage/Jahr</td></tr>
                    <tr><td><strong>Wartungskosten:</strong></td><td>{{ calculation.alt_wartungskosten }} €/Jahr</td></tr>
                </table>
            </div>
            {% endif %}

            <div>
                <h4 style="color: #0075BE; margin-bottom: 15px;">LED-System</h4>
                <table style="font-size: 10pt;">
                    <tr><td><strong>Hersteller:</strong></td><td>{{ calculation.neu_hersteller|default:"-" }}</td></tr>
                    <tr><td><strong>Modell:</strong></td><td>{{ calculation.neu_modell|default:"-" }}</td></tr>
                    <tr><td><strong>Leistung:</strong></td><td>{{ calculation.neu_leistung }} W</td></tr>
                    <tr><td><strong>Anzahl:</strong></td><td>{{ calculation.neu_anzahl }} Stück</td></tr>
                    <tr><td><strong>Betrieb:</strong></td><td>{{ calculation.neu_stunden_pro_tag }}h/Tag, {{ calculation.neu_tage_pro_jahr }} Tage/Jahr</td></tr>
                    <tr><td><strong>Anschaffung:</strong></td><td>{{ calculation.neu_anschaffungskosten_pro_stueck }} €/Stück</td></tr>
                    <tr><td><strong>Installation:</strong></td><td>{{ calculation.neu_installationskosten }} €</td></tr>
                    <tr><td><strong>Wartungskosten:</strong></td><td>{{ calculation.neu_wartungskosten }} €/Jahr</td></tr>
                </table>
            </div>
        </div>

        <div style="margin-top: 30px;">
            <h4 style="color: #28a745; margin-bottom: 15px;">LMS Konfiguration</h4>
            <table style="font-size: 10pt;">
                <tr>
                    <td><strong>Grundkosten System:</strong></td>
                    <td>{{ calculation.lms_grundkosten }} €</td>
                </tr>
                <tr>
                    <td><strong>Bewegungsmelder:</strong></td>
                    <td>{{ calculation.bewegungsmelder_mehrkosten }} € Mehrkosten</td>
                </tr>
                <tr>
                    <td><strong>Tageslichtsensor:</strong></td>
                    <td>{{ calculation.tageslicht_mehrkosten }} € Mehrkosten</td>
                </tr>
                <tr>
                    <td><strong>Kalender-Funktion:</strong></td>
                    <td>{% if calculation.kalender_aktiv %}Aktiviert{% else %}Deaktiviert{% endif %}</td>
                </tr>
                <tr>
                    <td><strong>Abwesenheits-Niveau:</strong></td>
                    <td>{{ calculation.bewegungsmelder_abwesenheit_niveau }}%</td>
                </tr>
                <tr>
                    <td><strong>Anwesenheits-Zeit:</strong></td>
                    <td>{{ calculation.bewegungsmelder_frequentierung_stunden }} h/Tag</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Investment Summary -->
    <div class="section">
        <div class="section-title">Investitionsübersicht</div>

        <table>
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Kosten</th>
                    <th>Anteil</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>LED-Leuchten ({{ calculation.neu_anzahl }} × {{ calculation.neu_anschaffungskosten_pro_stueck }} €)</td>
                    <td>{{ savings_data.led_equipment_cost|floatformat:0 }} €</td>
                    <td>{{ savings_data.led_equipment_percent|floatformat:1 }}%</td>
                </tr>
                <tr>
                    <td>Installation</td>
                    <td>{{ calculation.neu_installationskosten|floatformat:0 }} €</td>
                    <td>{{ savings_data.installation_percent|floatformat:1 }}%</td>
                </tr>
                <tr>
                    <td>LMS-System</td>
                    <td>{{ savings_data.investment_lms|floatformat:0 }} €</td>
                    <td>{{ savings_data.lms_percent|floatformat:1 }}%</td>
                </tr>
                <tr style="background: #f8f9fa; font-weight: bold;">
                    <td><strong>Gesamtinvestition</strong></td>
                    <td><strong>{{ savings_data.investment_total|floatformat:0 }} €</strong></td>
                    <td><strong>100%</strong></td>
                </tr>
            </tbody>
        </table>

        <div class="highlight-box">
            <h4 style="color: #0075BE; margin-top: 0;">Finanzierungsvorteil</h4>
            <p style="margin-bottom: 0; font-size: 12pt;">
                Die jährlichen Energieeinsparungen von <strong>{{ savings_data.cost_savings_lms|floatformat:0 }} €</strong>
                können zur Finanzierung der Investition genutzt werden. Bei einer typischen Finanzierungslaufzeit
                von 5 Jahren ergeben sich monatliche Raten von etwa
                <strong>{{ savings_data.monthly_financing_5y|floatformat:0 }} €</strong>,
                während die monatlichen Einsparungen bei
                <strong>{{ savings_data.monthly_savings|floatformat:0 }} €</strong> liegen.
            </p>
        </div>
    </div>

    <!-- Footer -->
    <div class="section mt-4">
        <div style="border-top: 2px solid #dee2e6; padding-top: 20px; text-align: center; color: #666;">
            <p style="margin: 0; font-size: 10pt;">
                Erstellt mit dem Wirtschaftlichkeitsrechner<br>
                Alle Berechnungen basieren auf den angegebenen Parametern und aktuellen Energiepreisen.<br>
                Änderungen der Rahmenbedingungen können zu abweichenden Ergebnissen führen.
            </p>
        </div>
    </div>
</body>
</html>