{% extends 'ideopin/base_wizard.html' %}

{% block wizard_content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-link-45deg"></i> Schritt 4: Pin-Link eingeben</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Wohin soll der Pinterest Pin verlinken? Dies ist die Zielseite,
                    die Nutzer sehen, wenn sie auf deinen Pin klicken.
                </p>

                <form method="post">
                    {% csrf_token %}

                    <div class="mb-4">
                        <label for="{{ form.pin_url.id_for_label }}" class="form-label fw-bold">
                            Ziel-URL
                        </label>
                        {{ form.pin_url }}
                        <div class="d-flex gap-2 mt-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertPrefix('https://')">
                                https://
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertPrefix('https://www.')">
                                https://www.
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertSuffix('.de')">
                                .de
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertSuffix('.com')">
                                .com
                            </button>
                        </div>
                        <div class="form-text">
                            Beispiel: https://deinshop.de/produkt-seite
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <i class="bi bi-lightbulb"></i>
                        <strong>Tipp:</strong> Verlinke auf eine spezifische Produktseite
                        oder Landingpage, nicht auf die Startseite.
                    </div>

                    <hr class="my-4">

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'ideopin:wizard_step3' project.id %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Zurück
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                            Weiter <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block wizard_js %}
<script>
const urlInput = document.getElementById('{{ form.pin_url.id_for_label }}');

function insertPrefix(text) {
    // Entferne existierendes http:// oder https:// wenn vorhanden
    let currentValue = urlInput.value;
    currentValue = currentValue.replace(/^https?:\/\/(www\.)?/i, '');
    urlInput.value = text + currentValue;
    urlInput.focus();
}

function insertSuffix(text) {
    // Füge Suffix am Ende hinzu (oder ersetze existierende TLD)
    let currentValue = urlInput.value;
    // Entferne existierende TLD am Ende wenn vorhanden
    currentValue = currentValue.replace(/\.(de|com|net|org|at|ch|eu|io)$/i, '');
    urlInput.value = currentValue + text;
    urlInput.focus();
}
</script>
{% endblock %}
