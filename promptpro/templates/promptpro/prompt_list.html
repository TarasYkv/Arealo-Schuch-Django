{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
  /* PromptPro compact & modern cards */
  .pp-card { border:1px solid rgba(0,0,0,0.06); border-radius:14px; box-shadow:0 8px 22px rgba(0,0,0,0.06); transition:transform .2s ease, box-shadow .2s ease; overflow:hidden; }
  .pp-card:hover { transform:translateY(-3px); box-shadow:0 14px 30px rgba(0,0,0,0.10); }
  .pp-accent { height:4px; width:100%; }
  .pp-accent-teal   { background: linear-gradient(90deg,#20c997,#6bd3c9); }
  .pp-accent-indigo { background: linear-gradient(90deg,#6366f1,#8b5cf6); }
  .pp-accent-purple { background: linear-gradient(90deg,#a855f7,#ec4899); }
  .pp-accent-orange { background: linear-gradient(90deg,#f59e0b,#f97316); }
  .pp-accent-cyan   { background: linear-gradient(90deg,#06b6d4,#22d3ee); }
  .pp-accent-pink   { background: linear-gradient(90deg,#f472b6,#fb7185); }
  .pp-chip { background: rgba(0,0,0,0.04); border:1px solid rgba(0,0,0,0.06); padding:.15rem .5rem; border-radius:999px; font-size:.75rem; }
  .pp-pre { background: rgba(0,0,0,0.03); border:1px dashed rgba(0,0,0,0.06); font-size:.9rem; line-height:1.35; max-height: 180px; overflow:auto; }
  .pp-title { font-size:1.05rem; }
  .pp-meta { font-size:.8rem; }
</style>
<div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
  <h2 class="mb-2 mb-sm-0">PromptPro</h2>
  <div class="d-flex gap-2">
    <a href="{% url 'promptpro:prompt_create' %}" class="btn btn-primary"><i class="bi bi-plus-lg me-1"></i> Neuer Prompt</a>
    <a href="{% url 'promptpro:category_overview' %}" class="btn btn-outline-secondary">Kategorien</a>
  </div>
  <div class="w-100"></div>
  <form method="get" class="d-flex align-items-center gap-2 mt-3 flex-wrap">
    <select name="kategorie" class="form-select" style="min-width: 220px;">
      <option value="">Alle Kategorien</option>
      {% for cat in categories %}
        <option value="{{ cat.slug }}" {% if selected_category and selected_category.id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="showMine" name="meine" value="1" {% if show_mine %}checked{% endif %}>
      <label class="form-check-label" for="showMine">Nur meine</label>
    </div>
    <button class="btn btn-outline-primary" type="submit"><i class="bi bi-funnel me-1"></i> Filtern</button>
  </form>
</div>

{% if prompts %}
<div class="row g-3">
  {% for p in prompts %}
  {% cycle 'teal' 'indigo' 'purple' 'orange' 'cyan' 'pink' as accent %}
  <div class="col-12 col-md-6 col-lg-4">
    <div class="pp-card h-100">
      <div class="pp-accent pp-accent-{{ accent }}"></div>
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start justify-content-between mb-2">
          <h5 class="card-title mb-0 pp-title">{{ p.title }}</h5>
          <span class="badge rounded-pill {% if p.visibility == 'public' %}bg-success{% else %}bg-secondary{% endif %}">
            {% if p.visibility == 'public' %}Ã–ffentlich{% else %}Privat{% endif %}
          </span>
        </div>
        {% if p.category %}
          <span class="pp-chip mb-2">{{ p.category.name }}</span>
        {% endif %}
        {% if p.description %}
          <p class="text-muted small mb-3" style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">{{ p.description }}</p>
        {% endif %}
        <pre class="pp-pre p-2 rounded small flex-grow-1" style="white-space: pre-wrap;">{{ p.content }}</pre>
        <div class="d-flex align-items-center justify-content-between mt-3">
          <small class="text-muted pp-meta">von {{ p.owner.username }}</small>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-primary" onclick="navigator.clipboard.writeText(`{{ p.content|escapejs }}`)">
              <i class="bi bi-clipboard"></i> Kopieren
            </button>
            {% if p.owner_id == request.user.id or request.user.is_superuser %}
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'promptpro:prompt_edit' p.id %}"><i class="bi bi-pencil"></i></a>
              <a class="btn btn-sm btn-outline-danger" href="{% url 'promptpro:prompt_delete' p.id %}"><i class="bi bi-trash"></i></a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="text-center text-muted py-5">
  <p>Keine Prompts gefunden.</p>
  <a href="{% url 'promptpro:prompt_create' %}" class="btn btn-primary">Prompt anlegen</a>
  {% if request.user.is_superuser %}
    <a href="{% url 'promptpro:category_create' %}" class="btn btn-outline-secondary ms-2">Kategorie anlegen</a>
  {% endif %}
  
</div>
{% endif %}
{% endblock %}
