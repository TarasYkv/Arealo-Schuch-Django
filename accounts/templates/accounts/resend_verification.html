{% extends 'base.html' %}

{% block title %}E-Mail-Bestätigung erneut senden{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-envelope text-primary" style="font-size: 3rem;"></i>
                        <h3 class="mt-3">E-Mail-Bestätigung erneut senden</h3>
                        <p class="text-muted">
                            Geben Sie Ihre E-Mail-Adresse ein, um eine neue Bestätigungs-E-Mail zu erhalten.
                        </p>
                    </div>
                    
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <form method="post" id="resendForm">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="email" class="form-label">E-Mail-Adresse</label>
                            <input type="email" class="form-control" id="email" name="email" required 
                                   placeholder="ihre.email@beispiel.de">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="resendBtn">
                                <i class="fas fa-paper-plane" id="btnIcon"></i>
                                <span id="btnText">E-Mail erneut senden</span>
                                <div id="btnSpinner" class="spinner-border spinner-border-sm d-none" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </div>
                        
                        <!-- Loading message -->
                        <div id="loadingMessage" class="d-none mt-3">
                            <div class="alert alert-info">
                                <div class="d-flex align-items-center">
                                    <div class="spinner-border spinner-border-sm text-info me-3" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <div>
                                        <strong>E-Mail wird versendet...</strong><br>
                                        <small>Dies kann einen Moment dauern. Bitte warten Sie.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    
                    <hr class="my-4">
                    
                    <div class="text-center">
                        <p class="text-muted mb-2">Bereits bestätigt?</p>
                        <a href="{% url 'accounts:login' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-sign-in-alt"></i> Zur Anmeldung
                        </a>
                    </div>
                    
                    <div class="mt-4">
                        <div class="alert alert-info">
                            <small>
                                <strong>Hinweis:</strong> Aus Sicherheitsgründen können Sie nur alle 5 Minuten 
                                eine neue E-Mail anfordern. Prüfen Sie auch Ihren Spam-Ordner.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('resendForm').addEventListener('submit', function() {
    const resendBtn = document.getElementById('resendBtn');
    const btnIcon = document.getElementById('btnIcon');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    const loadingMessage = document.getElementById('loadingMessage');
    
    // Disable button and show loading state
    resendBtn.disabled = true;
    resendBtn.classList.add('disabled');
    
    // Update button appearance
    btnIcon.style.display = 'none';
    btnText.textContent = 'Wird versendet...';
    btnSpinner.classList.remove('d-none');
    
    // Show loading message
    loadingMessage.classList.remove('d-none');
    
    // Scroll to loading message
    loadingMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
});

// Reset button if form is redisplayed (e.g., validation error)
window.addEventListener('load', function() {
    const hasMessages = document.querySelector('.alert');
    if (hasMessages) {
        const resendBtn = document.getElementById('resendBtn');
        const btnIcon = document.getElementById('btnIcon');
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');
        const loadingMessage = document.getElementById('loadingMessage');
        
        // Reset button state
        resendBtn.disabled = false;
        resendBtn.classList.remove('disabled');
        btnIcon.style.display = 'inline';
        btnText.textContent = 'E-Mail erneut senden';
        btnSpinner.classList.add('d-none');
        loadingMessage.classList.add('d-none');
    }
});
</script>
{% endblock %}