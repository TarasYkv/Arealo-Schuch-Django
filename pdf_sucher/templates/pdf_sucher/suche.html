<!-- Kompletter Inhalt für: templates/pdf_sucher/suche.html -->
{% extends 'base.html' %}

{% block content %}

<!-- Zusätzliche Stile für ein feineres Design -->
<style>
    .card-header {
        background-color: rgba(0, 64, 119, 0.05); /* Ein sehr helles Firmenblau */
        font-weight: 500;
    }
    .list-group-item {
        transition: background-color 0.2s ease-in-out;
    }
</style>

<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">

        <h1 class="text-center mb-4">Intelligente PDF-Suche</h1>
        <p class="lead text-center text-muted mb-5">Laden Sie ein PDF-Dokument hoch und stellen Sie eine präzise Frage an den Inhalt, um relevante Textstellen zu extrahieren.</p>

        <!-- Formular in einer "Card" für bessere Struktur -->
        <div class="card shadow-sm mb-5">
            <div class="card-header">
                1. Analyse starten
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="suchFormular">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="pdf_datei" class="form-label">PDF-Datei auswählen</label>
                        <input class="form-control" type="file" id="pdf_datei" name="pdf_datei" accept=".pdf" required>
                    </div>
                    <div class="mb-3">
                        <label for="suchanfrage" class="form-label">Suchanfrage oder Frage an das Dokument</label>
                        <input type="text" class="form-control" id="suchanfrage" name="suchanfrage" placeholder="z.B. 'Fasse die wichtigsten Vertragsstrafen zusammen'" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg w-100" id="suchButton">Suche starten</button>
                </form>
            </div>
        </div>

        <!-- NEU: Der Ladebalken (standardmäßig versteckt) -->
        <div id="ladeanzeige" class="mt-5 text-center" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5 class="mt-3">Suche läuft...</h5>
            <p class="text-muted">Die Analyse größerer Dokumente kann einen Moment dauern.</p>
        </div>

        <!-- Ergebnis-Anzeige -->
        {% if error_message %}
            <div class="alert alert-danger mt-5">
                <h4>Fehler</h4>
                <p>{{ error_message }}</p>
            </div>
        {% endif %}

        {% if ergebnisse %}
            <h2 class="mt-5">Gefundene Textstellen</h2>
            <div class="list-group">
                {% for ergebnis in ergebnisse %}
                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">Treffer</h5>
                            <span class="badge bg-secondary rounded-pill">Seite {{ ergebnis.seitenzahl }}</span>
                        </div>
                        <p class="mb-1 mt-2">"<em>{{ ergebnis.textstelle }}</em>"</p>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

    </div>
</div>

{% endblock %}


{% block scripts %}
<!-- Kleines JavaScript am Ende der Seite -->
<script>
    const suchFormular = document.getElementById('suchFormular');
    const ladeanzeige = document.getElementById('ladeanzeige');
    const suchButton = document.getElementById('suchButton');

    suchFormular.addEventListener('submit', function() {
        ladeanzeige.style.display = 'block';
        suchButton.disabled = true;
        suchButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Analyse läuft...';
    });
</script>
{% endblock %}
