{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if form.instance.pk %}Projekt bearbeiten{% else %}Neues Projekt erstellen{% endif %} - LoomLine
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-project-diagram me-2"></i>
                        {% if form.instance.pk %}Projekt bearbeiten{% else %}Neues SEO Projekt erstellen{% endif %}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                        <div class="alert alert-danger" role="alert">
                            {{ form.non_field_errors }}
                        </div>
                        {% endif %}

                        <div class="mb-3">
                            <label for="{{ form.name.id_for_label }}" class="form-label">
                                Project Name <span class="text-danger">*</span>
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.name.errors.0 }}
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">Choose a descriptive name for your SEO project</small>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.description.id_for_label }}" class="form-label">
                                Description
                            </label>
                            {{ form.description }}
                            {% if form.description.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.description.errors.0 }}
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">Provide details about your project goals and scope</small>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.domain.id_for_label }}" class="form-label">
                                Domain/Website
                            </label>
                            {{ form.domain }}
                            {% if form.domain.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.domain.errors.0 }}
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">The website you're tracking SEO for (e.g., example.com)</small>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.target_keywords.id_for_label }}" class="form-label">
                                Target Keywords
                            </label>
                            {{ form.target_keywords }}
                            {% if form.target_keywords.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.target_keywords.errors.0 }}
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">Comma-separated list of primary keywords to track</small>
                        </div>

                        {% if not form.instance.pk %}
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="shareWithTeam" name="share_with_team">
                                <label class="form-check-label" for="shareWithTeam">
                                    Share with team members after creation
                                </label>
                            </div>
                        </div>
                        {% endif %}

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'loomline:dashboard' %}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>
                                {% if form.instance.pk %}Save Changes{% else %}Create Project{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            {% if form.instance.pk %}
            <div class="card mt-3">
                <div class="card-body">
                    <h6 class="text-muted">Project Information</h6>
                    <small>
                        <strong>Created:</strong> {{ form.instance.created_at|date:"M d, Y H:i" }}<br>
                        <strong>Owner:</strong> {{ form.instance.owner.get_full_name|default:form.instance.owner.username }}<br>
                        <strong>Members:</strong> {{ form.instance.members.count }} member{{ form.instance.members.count|pluralize }}
                    </small>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add Bootstrap classes to Django form fields
    const formFields = document.querySelectorAll('input[type="text"], input[type="url"], textarea');
    formFields.forEach(field => {
        field.classList.add('form-control');
        if (field.hasAttribute('required')) {
            field.setAttribute('required', '');
        }
    });

    // Auto-format domain input
    const domainInput = document.querySelector('input[name="domain"]');
    if (domainInput) {
        domainInput.addEventListener('blur', function() {
            let value = this.value.trim();
            if (value && !value.startsWith('http')) {
                value = value.replace(/^(https?:\/\/)?(www\.)?/, '');
                this.value = value;
            }
        });
    }
});
</script>
{% endblock %}