{% extends "clawboard/base_dark.html" %}
{% load static %}

{% block title %}Connector Setup - Clawboard{% endblock %}

{% block cb_page %}
<div class="cb-page-header">
    <div>
        <div class="cb-breadcrumb">
            <a href="{% url 'clawboard:dashboard' %}">Clawboard</a>
            <span class="separator">/</span>
            <span class="current">Connector Setup</span>
        </div>
        <h1 class="cb-page-title"><i class="bi bi-terminal me-2"></i>Connector Setup</h1>
        <span class="cb-page-subtitle">Verbinde deinen Rechner mit dem Clawboard Dashboard.</span>
    </div>
</div>

<div style="max-width: 680px;">
    {% if not active_connection %}
        <div class="cb-card">
            <div class="cb-card-body" style="text-align: center; padding: 40px 20px;">
                <i class="bi bi-exclamation-circle" style="font-size: 2.5rem; color: #f9e2af; display: block; margin-bottom: 12px;"></i>
                <h4 style="color: #cdd6f4; margin-bottom: 8px;">Erst eine Verbindung erstellen</h4>
                <p style="color: #6c7086; margin-bottom: 20px;">
                    Bevor du den Connector nutzen kannst, musst du eine Verbindung anlegen.
                </p>
                <a href="{% url 'clawboard:connection_add' %}" class="cb-btn cb-btn-primary cb-btn-lg">
                    <i class="bi bi-plus-lg me-2"></i>Verbindung erstellen
                </a>
            </div>
        </div>
    {% else %}

    <!-- Schritt 1: Download -->
    <div class="cb-card" style="margin-bottom: 16px;">
        <div class="cb-card-header">
            <h6><i class="bi bi-download me-2"></i>1. Dateien herunterladen</h6>
        </div>
        <div class="cb-card-body">
            <p style="color: #6c7086; font-size: 0.82rem; margin-bottom: 8px;">Gehe in deinen <code style="color: #89b4fa;">openclaw</code> Ordner und lade die Dateien herunter:</p>
            <div class="cb-code-block" style="margin-bottom: 8px;">
                <code>cd ~/openclaw</code>
            </div>
            <div class="cb-code-block">
                <button class="cb-code-copy" onclick="copyCmd('cmd-download', this)">
                    <i class="bi bi-clipboard me-1"></i>Kopieren
                </button>
                <code id="cmd-download" style="padding-right: 80px; display: block;">curl -sL "{{ script_url }}" -o connector.py && curl -sL "{{ config_url }}" -o config.json</code>
            </div>
        </div>
    </div>

    <!-- Schritt 2: Starten -->
    <div class="cb-card" style="margin-bottom: 16px;">
        <div class="cb-card-header">
            <h6><i class="bi bi-play-circle me-2"></i>2. Im Hintergrund starten</h6>
        </div>
        <div class="cb-card-body">
            <p style="color: #6c7086; font-size: 0.82rem; margin-bottom: 8px;">Laeuft weiter, auch wenn du das Terminal schliesst:</p>
            <div class="cb-code-block">
                <button class="cb-code-copy" onclick="copyCmd('cmd-bg', this)">
                    <i class="bi bi-clipboard me-1"></i>Kopieren
                </button>
                <code id="cmd-bg" style="padding-right: 80px; display: block;">nohup python3 connector.py --config config.json > connector.log 2>&1 &</code>
            </div>
        </div>
    </div>

    <!-- NÃ¼tzliche Befehle -->
    <div class="cb-card">
        <div class="cb-card-header">
            <h6><i class="bi bi-terminal me-2"></i>Nuetzliche Befehle</h6>
        </div>
        <div class="cb-card-body">
            <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; color: #6c7086; display: block; margin-bottom: 4px;">Log ansehen:</span>
                <div class="cb-code-block" style="margin-bottom: 0;"><code>tail -f ~/openclaw/connector.log</code></div>
            </div>
            <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; color: #6c7086; display: block; margin-bottom: 4px;">Stoppen:</span>
                <div class="cb-code-block" style="margin-bottom: 0;"><code>pkill -f "connector.py"</code></div>
            </div>
            <div>
                <span style="font-size: 0.75rem; color: #6c7086; display: block; margin-bottom: 4px;">Pruefen ob er laeuft:</span>
                <div class="cb-code-block" style="margin-bottom: 0;"><code>pgrep -af "connector.py"</code></div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block cb_extra_script %}
<script>
function copyCmd(id, btn) {
    const cmd = document.getElementById(id).textContent;
    navigator.clipboard.writeText(cmd).then(function() {
        const orig = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check me-1"></i>Kopiert!';
        btn.style.background = '#a6e3a133';
        btn.style.color = '#a6e3a1';
        setTimeout(function() {
            btn.innerHTML = orig;
            btn.style.background = '';
            btn.style.color = '';
        }, 2000);
    });
}
</script>
{% endblock %}
