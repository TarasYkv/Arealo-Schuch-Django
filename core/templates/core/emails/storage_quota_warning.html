<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px; }
        .alert { padding: 15px; margin: 20px 0; border-radius: 5px; }
        .alert-warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; }
        .progress { background: #e9ecef; height: 30px; border-radius: 15px; overflow: hidden; margin: 20px 0; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #28a745, #20c997); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .progress-bar.warning { background: linear-gradient(90deg, #ffc107, #fd7e14); }
        .progress-bar.danger { background: linear-gradient(90deg, #dc3545, #c82333); }
        .btn { display: inline-block; padding: 12px 30px; background: #0d6efd; color: white; text-decoration: none; border-radius: 5px; margin: 10px 0; }
        .stats { background: white; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{% if is_critical %}‚ùå{% elif usage_percent >= 90 %}üö®{% else %}‚ö†Ô∏è{% endif %} Speicher-Benachrichtigung</h1>
        </div>

        <div class="content">
            <p>Hallo {{ user.get_full_name|default:user.username }},</p>

            <div class="alert {% if is_critical %}alert-danger{% else %}alert-warning{% endif %}">
                {% if is_critical %}
                    <strong>Ihr Speicherlimit wurde erreicht!</strong><br>
                    Sie haben Ihr Speicherlimit von <strong>{{ max_mb|floatformat:0 }} MB</strong> √ºberschritten.
                    Neue Uploads sind nicht mehr m√∂glich.
                {% elif usage_percent >= 90 %}
                    <strong>Achtung: Ihr Speicher ist zu {{ usage_percent }}% belegt!</strong><br>
                    Sie haben nur noch {{ max_mb|floatformat:0|add:"-"|add:used_mb|floatformat:0 }} MB verf√ºgbaren Speicher.
                {% else %}
                    <strong>Ihr Speicher ist zu {{ usage_percent }}% belegt</strong><br>
                    Bitte beachten Sie Ihre Speichernutzung.
                {% endif %}
            </div>

            <div class="progress">
                <div class="progress-bar {% if is_critical %}danger{% elif usage_percent >= 90 %}danger{% elif usage_percent >= 75 %}warning{% endif %}"
                     style="width: {{ usage_percent }}%;">
                    {{ usage_percent|floatformat:1 }}%
                </div>
            </div>

            <div class="stats">
                <h3>Ihre Speichernutzung:</h3>
                <ul>
                    <li><strong>Verwendet:</strong> {{ used_mb|floatformat:1 }} MB ({{ used_gb|floatformat:2 }} GB)</li>
                    <li><strong>Verf√ºgbar:</strong> {{ max_mb|floatformat:0 }} MB ({{ max_gb|floatformat:2 }} GB)</li>
                    <li><strong>Aktueller Plan:</strong> {{ tier_name }}</li>
                    {% if current_price > 0 %}
                    <li><strong>Preis:</strong> {{ current_price }}‚Ç¨/Monat</li>
                    {% endif %}
                </ul>

                {% if by_app %}
                <h4>Speichernutzung pro App:</h4>
                <ul>
                    {% for app, bytes in by_app.items %}
                    <li><strong>{{ app|capfirst }}:</strong> {{ bytes|filesizeformat }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <h3>Was k√∂nnen Sie tun?</h3>
            <ul>
                <li><strong>Dateien l√∂schen:</strong> Entfernen Sie ungenutzte Dateien um Speicher freizugeben</li>
                <li><strong>Upgrade durchf√ºhren:</strong> Erweitern Sie Ihren Speicherplan f√ºr mehr Platz</li>
                <li><strong>Dateien archivieren:</strong> Lagern Sie selten genutzte Dateien aus</li>
            </ul>

            <center>
                <a href="{{ upgrade_url }}" class="btn">
                    üöÄ Jetzt Speicher erweitern
                </a>
            </center>

            <p style="margin-top: 30px; color: #666; font-size: 0.9em;">
                <em>Diese E-Mail wurde automatisch generiert. Bei Fragen kontaktieren Sie bitte unseren Support.</em>
            </p>
        </div>
    </div>
</body>
</html>
